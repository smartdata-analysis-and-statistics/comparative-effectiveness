---
title: "Dealing with irregular and informative visits"
author: "Thomas Debray"
date: "12-4-2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source("Chapter 10 - Dealing with irregular and informative visits/sim.r")
source("Chapter 10 - Dealing with irregular and informative visits/fig_functions.r")

```

## Data generation

Simulate a randomized clinical trial with no treatment effect

```{r}
sim_data <- sim_data_EDSS(tx_alloc_FUN = treatment_alloc_randomized, delta_xt = 0)
plot_distribution_edss(sim_data)
```

Simulate a randomized clinical trial with a (linear) treatment effect

```{r}
sim_data <- sim_data_EDSS(tx_alloc_FUN = treatment_alloc_randomized, delta_xt = -0.007)
plot_distribution_edss(sim_data)
```

Simulate a dataset with unequal treatment allocation

```{r}
sim_data <- sim_data_EDSS(tx_alloc_FUN = treatment_alloc_confounding, delta_xt = -0.007)
plot_distribution_edss(sim_data)
```

## Introduce missing visits

The following censoring functions are available to introduce informative patient visits: 

* `censor_visits_a1` : Patient visits are missing according to center only
* `censor_visits_a2` : Patient visits are missing according to center and received treatment
* `censor_visits_a3` : Visit schedules are regular but differ between treatment groups
* `censor_visits_a4` : Patient visits are missing according to their received treatment and current EDSS score


```{r}
sim_data_censored <- censor_visits_a2(data = sim_data)
plot_prob_visit(sim_data_censored)
sim_data_censored <- censor_visits_a3(data = sim_data)
plot_prob_visit(sim_data_censored)
```

## Impute missing data


## Next steps

* Add a covariate in the data generation model. For example, generate binary variable gender with 0=male, 1=female. I would recommend a population of 75\% females. The prognostic effect of female gender on EDSS score could be set to â€“0.20  (see Tilling K, et al. Modelling disease progression in relapsing-remitting onset multiple sclerosis using multilevel models applied to longitudinal data from two natural history cohorts and one treated cohort. Health Technol Assess. 2016)
* 
