{
  "hash": "f2b56ab403f7f27b0524af8b3071f841",
  "result": {
    "markdown": "---\ntitle: \"Effect Modification Analysis within the Propensity score Framework\"\nauthor: \"Mohammad Ehsanul Karim\"\nformat:\n  html:\n    toc: true\n    number-sections: true\neditor: visual\nexecute:\n  cache: true\n---\n\n\n\n\n\n## Simulation\n\nFirst, we need to install the R package `simcausal`, which can be obtained from GitHub:\n\n\n::: {.cell hash='chapter_07_cache/pdf/unnamed-chunk-2_958dcfc98e6d05db1895158afa1b0f65'}\n\n```{.r .cell-code}\ndevtools::install_github('osofr/simcausal', build_vignettes = FALSE)\n```\n:::\n\n\n\nWe will use the following data-generation model:\n\n\n\n::: {.cell hash='chapter_07_cache/pdf/unnamed-chunk-3_da04be1f1567860ffb5097ce1b1fe6c7'}\n\n```{.r .cell-code}\nrequire(simcausal)\nD <- DAG.empty()\nD <- D + \n  node(\"age\", distr = \"rnorm\", \n       mean = 2, sd = 4) + \n  node(\"gender\", distr = \"rbern\", \n       prob = plogis(4)) +\n  node(\"education\", distr = \"rbern\", \n       prob = plogis(3 + 5* age)) +\n  node(\"diet\", distr = \"rbern\", \n       prob = plogis(1 -3 * education)) +\n  node(\"income\", distr = \"rbern\", \n       prob = plogis(2 - 5 * education - 4 * age)) +\n  node(\"smoking\", distr = \"rbern\", \n       prob = plogis(1 + 1.2 * gender + 2 * age)) +\n  node(\"hypertension\", distr = \"rbern\", \n       prob = plogis(1 + log(3) * diet + \n                       log(1.3) * age + \n                       log(3.5) * smoking + \n                       log(0.5) * gender))\nDset <- set.DAG(D)\nplotDAG(Dset)\n```\n\n::: {.cell-output-display}\n![](chapter_07_files/figure-pdf/unnamed-chunk-3-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n\nWe can now generate an example dataset:\n\n\n\n::: {.cell hash='chapter_07_cache/pdf/unnamed-chunk-4_cfbcc8b01bd97816ee84417effddccb8'}\n\n```{.r .cell-code}\nObs.Data <- sim(DAG = Dset, n = 50000, rndseed = 123)\n\nObs.Data$smoking <- as.character(Obs.Data$smoking)\nObs.Data$income <- as.factor(Obs.Data$income)\nObs.Data$income <- relevel(Obs.Data$income, ref = \"1\")\n```\n:::\n\n\n\nSample data from the hypothetical example of association between hypertension and  smoking, where other variables such as income, age [centered], gender, education and diet also plays a role in the data generation process.\n\n\n::: {.cell hash='chapter_07_cache/pdf/unnamed-chunk-5_08407863911ea03b19a7e0b3ddd9d694'}\n::: {.cell-output .cell-output-stdout}\n```\n            age gender education diet income smoking hypertension\n34901 12.288936      1         1    1      0       1            1\n149   10.400436      1         1    0      0       1            1\n10060  2.991820      1         1    0      0       1            0\n22220 -4.311952      0         0    0      1       0            1\n9979  -6.435549      0         0    0      1       0            1\n```\n:::\n:::\n\n\n\n## Effect measure assessment via adding interaction term\n\nBelow, we estimate a logistic regression model to assess whether the effect of smoking (the exposure) on hypertension is modified by income. The covariates age and gender are confounders.\n\n\n\n::: {.cell hash='chapter_07_cache/pdf/unnamed-chunk-6_728c569c7ee373d5a4ad3d7ff6fd0c14'}\n\n```{.r .cell-code}\nfit.w.em <- glm(hypertension ~ smoking * income + age + gender, \n            family = binomial(link = \"logit\"), data = Obs.Data)\n\nrequire(jtools)\nresults.model <- summ(fit.w.em, model.info = FALSE, \n                      model.fit = FALSE,\n                      exp = TRUE)\nresults.model\n```\n\n::: {.cell-output-display}\n\\begin{table}[!h]\n\\centering\n\\begin{threeparttable}\n\\begin{tabular}{lrrrrr}\n\\toprule\n  & exp(Est.) & 2.5\\% & 97.5\\% & z val. & p\\\\\n\\midrule\n\\cellcolor{gray!6}{(Intercept)} & \\cellcolor{gray!6}{5.46} & \\cellcolor{gray!6}{4.37} & \\cellcolor{gray!6}{6.82} & \\cellcolor{gray!6}{14.97} & \\cellcolor{gray!6}{0.00}\\\\\nsmoking1 & 2.93 & 2.60 & 3.30 & 17.69 & 0.00\\\\\n\\cellcolor{gray!6}{income0} & \\cellcolor{gray!6}{0.48} & \\cellcolor{gray!6}{0.41} & \\cellcolor{gray!6}{0.57} & \\cellcolor{gray!6}{-8.28} & \\cellcolor{gray!6}{0.00}\\\\\nage & 1.29 & 1.27 & 1.31 & 36.77 & 0.00\\\\\n\\cellcolor{gray!6}{gender} & \\cellcolor{gray!6}{0.54} & \\cellcolor{gray!6}{0.43} & \\cellcolor{gray!6}{0.67} & \\cellcolor{gray!6}{-5.55} & \\cellcolor{gray!6}{0.00}\\\\\n\\addlinespace\nsmoking1:income0 & 1.27 & 1.04 & 1.56 & 2.33 & 0.02\\\\\n\\bottomrule\n\\end{tabular}\n\\begin{tablenotes}\n\\item Standard errors: MLE\n\\end{tablenotes}\n\\end{threeparttable}\n\\end{table}\n:::\n:::\n\n\n\nThe interaction term in `results.model` is statistically significant.\n\n\n### Presentation of effect measures {.unnumbered}\nWe can generate a summary report from aforementioned effect modification analysis. The table below depicts the adjusted odds ratios  for income levels (`high = 0`, and `low = 1`)\n\n\n::: {.cell hash='chapter_07_cache/pdf/unnamed-chunk-7_33465fddd43f9cd093a87b62c2653772'}\n\n```{.r .cell-code}\nrequire(interactionR)\nem.object <- interactionR(fit.w.em, \n                          exposure_names = c(\"income0\", \"smoking1\"), \n                          ci.type = \"mover\", ci.level = 0.95, \n                          em = TRUE, recode = FALSE)\n\nem.object$dframe[5:7,]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                             Measures Estimates    CI.ll    CI.ul            p\n5 OR(smoking1 on outcome [income0==0]  2.930160 2.601065 3.300894 5.349900e-70\n6 OR(smoking1 on outcome [income0==1]  3.723958 3.143492 4.411612 3.039753e-47\n7                Multiplicative scale  1.270906 1.038505 1.555314 1.998370e-02\n```\n:::\n:::\n\n\n\n## Effect measure assessment via stratified approach\n\n\n\n::: {.cell hash='chapter_07_cache/pdf/unnamed-chunk-8_ed05f3f53fcf303c32a4ff58bcda9569'}\n\n```{.r .cell-code}\nfit.income1 <- glm(hypertension ~ smoking + age + gender, \n            family = binomial(link = \"logit\"), \n            data = subset(Obs.Data, income == 1))\nfit.income0 <- glm(hypertension ~ smoking + age + gender, \n            family=binomial(link = \"logit\"), \n            data= subset(Obs.Data, income == 0))\n```\n:::\n\n\n\nThe table below summarizes the adjusted odds ratios for smoking across the different income levels (`low = 1`, and `high = 0`) as obtained using the stratified approach.\n\n\n\n::: {.cell hash='chapter_07_cache/pdf/unnamed-chunk-9_537cd61f4efd2b5f1bd0ea474a8d5baa'}\n::: {.cell-output .cell-output-stdout}\n```\n     Value of income exp(Est.)     2.5%    97.5%   z val.            p\n[1,]               1  3.066878 2.707961 3.473366 17.64728 1.067842e-69\n[2,]               0  3.590260 3.023124 4.263792 14.57113 4.287200e-48\n```\n:::\n:::\n\n\n\nWe can investige effect modification between income (the modifier) and all covariates as follows:\n\n\n\n::: {.cell hash='chapter_07_cache/pdf/unnamed-chunk-10_08102a2fe77fe4e623e1e8484b25d398'}\n\n```{.r .cell-code}\nfit.all.int <- glm(hypertension ~ income * (smoking + age + gender), \n            family = binomial(link = \"logit\"), data = Obs.Data)\n```\n:::\n\n::: {.cell hash='chapter_07_cache/pdf/unnamed-chunk-11_dd810f6ad1271fa5963db45cf802cd24'}\n::: {.cell-output .cell-output-stdout}\n```\n                    Variable Units OddsRatio       CI.95 p-value\n1 income(1): smoking(1 vs 0)            3.07 [2.71;3.47] < 1e-04\n2 income(0): smoking(1 vs 0)            3.59 [3.02;4.26] < 1e-04\n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{\"knit_meta_id\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\",\"\"]}},\"value\":[{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"array\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"multirow\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"xcolor\"]},{\"type\":\"character\",\"attributes\":{},\"value\":[\"table\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"wrapfig\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"float\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"colortbl\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"pdflscape\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"tabu\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"threeparttable\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"threeparttablex\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"ulem\"]},{\"type\":\"character\",\"attributes\":{},\"value\":[\"ulem\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"makecell\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"babel\"]},{\"type\":\"character\",\"attributes\":{},\"value\":[\"greek\",\"english\"]}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"array\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"multirow\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"wrapfig\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"float\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"colortbl\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"pdflscape\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"tabu\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"threeparttable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"threeparttablex\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"ulem\"]},{\"type\":\"character\",\"attributes\":{},\"value\":[\"normalem\"]},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"makecell\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"xcolor\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]}]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}